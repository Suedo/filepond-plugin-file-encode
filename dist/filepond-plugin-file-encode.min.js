/*
 * FilePondPluginFileEncode 2.1.0
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */

/* eslint-disable */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.FilePondPluginFileEncode=n()}(this,function(){"use strict";var u=function(){self.onmessage=function(n){e(n.data.message,function(e){self.postMessage({id:n.data.id,message:e})})};var e=function(e,n){var t=e.file,i=new FileReader;i.onloadend=function(){n(i.result.replace("data:","").replace(/^.+,/,""))},i.readAsDataURL(t)}},e=function(e){var n=e.addFilter,t=e.utils,i=t.Type,o=t.createWorker,a=t.createRoute,r=t.isFile,d=function(e){var i=e.name,a=e.file;return new Promise(function(n){var t=o(u);t.post({file:a},function(e){n({name:i,data:e}),t.terminate()})})},f=[];return n("SHOULD_PREPARE_OUTPUT",function(){return new Promise(function(e){e(!0)})}),n("COMPLETE_PREPARE_OUTPUT",function(t,e){var i=e.item;return new Promise(function(n){if(!r(t)&&!Array.isArray(t))return n(t);f[i.id]={metadata:i.getMetadata(),imagedata:null},Promise.all((t instanceof Blob?[{name:null,file:t}]:t).map(d)).then(function(e){f[i.id].imagedata=t instanceof Blob?e[0].data:e,n(t)})})}),n("CREATE_VIEW",function(e){var n=e.is,t=e.view,d=e.query;n("file-wrapper")&&d("GET_ALLOW_FILE_ENCODE")&&t.registerWriter(a({DID_PREPARE_OUTPUT:function(e){var n=e.root,t=e.action;if(!d("IS_ASYNC")){var i=d("GET_ITEM",t.id);if(i){var a=f[i.id],o=a.metadata,r=a.imagedata;n.ref.data.value=JSON.stringify({id:i.id,name:i.file.name,type:i.file.type,size:i.file.size,metadata:o,data:r}),f[i.id].imagedata=null}}}}))}),{options:{allowFileEncode:[!0,i.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:e})),e});